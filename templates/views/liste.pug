extends ../layouts/default

block content
	.container
		.row
			.col-lg-12
				h1 Liste des annonces
		.row
			table.table.table-hover
				thead
					th(scope="col") date
					th(scope="col") type
					th(scope="col") déposant
					th(scope="col") annonce
					th(scope="col") status
					th(scope="col") action
				tbody
					each annonce in data.annonces
						tr
							th(scope="row")= annonce._.dateDepot.format('DD/MM/YYYY H:mm')
							td
								p= annonce.type
								p= annonce.quartier
							td
								p= annonce.prenom + ' ' + annonce.nom
								p= annonce.email
								p= annonce.telephone
							td
								h5= annonce.titre
								p= annonce.message
							if annonce.validee
								td.bg-success
									span.text-white En ligne
							else
								td.bg-danger
									span.text-white A modérer
							td
								.btn-group(role="group")
									button.btn.btn-success.btn-action(type="button", data-annonce= "/api/valide/" + annonce.id) Valider
									a.btn.btn-warning.btn-action(type="button", href= "/keystone/annonces/" + annonce.id) modifier
									button.btn.btn-danger.btn-action(type="button", data-annonce= "/api/delete/" + annonce.id) Supprimer

block js
	script.
		(function() {
			'use strict';
			window.addEventListener('load', function() {
				var inputs = document.getElementsByClassName('btn-action')
				var url, button;
				Array.prototype.filter.call(inputs, function(input) {
					input.addEventListener('click', function(event) {
						button = $( this );
						url = button.data('annonce');
						if (url) {
							console.log(url)
							$.get(url).done(function () {
								location.reload(true);
							})
						}
					}, false);
				});
			}, false);
		})()


